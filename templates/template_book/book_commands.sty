% ------------------------------------------------------------------------------------------------- %
%								book_commands.sty  	Marcel Zauder 02/04/2023						%
% Stylesheet by Marcel                                                                              %
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------- Variables ------------------------------------------- %
\newcommand{\ThanksSpacing}{3cm}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ----------------------------------------- ToC  Commands ----------------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-# Removes "Chapter ##:"  from ToC Entry #-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
\titlecontents{chapter}
	[0pt] % left
	{ \addvspace{.1in} \DndFontTocChapter } % above-code
	{} % numbered-entry-format
	{} % numberless-entry-format
	{\titlerule*{.}\contentspage} % filler-page-format
% ------------------------------------------------------------------------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#  ToC Plain-Style  #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
\AtBeginDocument{\addtocontents{toc}{\protect\thispagestyle{empty}}}
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ------------------------------------------- Titlepage ------------------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#  Book  Titlepage  #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
\newcommand{\bookTitlePage}[9]{%
	\begin{titlepage}
		\begin{tikzpicture}[remember picture,overlay]
			\node[opacity=1,inner sep=0pt,xshift=#3,yshift=#4] at (current page.center){\includegraphics[#5, keepaspectratio]{#2}};
			\addImageDBEntry{FrontCover}{Front Cover}{Art}{#6}{#7}{#8}
			\node[yshift=0.395\paperheight] at (current page.center) {\shadowfyBookTitleName{#1}};
			
			\node[yshift=0.45\paperheight] at (current page.center) {%
				\includegraphics[width=0.11\paperwidth, keepaspectratio]{%
					\PATH  templates/template_book/images/titlepage/icons/5eMC.png%
				}%
			};%		
			\coordinate (redline_left) at ($(current page.center) + (-0.3\paperwidth, 0.365\paperheight)$);
			\draw [rulered, fill = red] (redline_left) -- ++( 0.3\paperwidth, 0.075 ) -- ++( 0.3\paperwidth, -0.075 ) -- ++( -0.3\paperwidth, -0.075 );
			
			\node[yshift=-0.325\paperheight, xshift=-0.3\paperwidth] at (current page.center){%
				\includegraphics[width=0.4\paperwidth, keepaspectratio]{%
					\PATH templates/template_book/images/titlepage/Homebrew_Banner.png%
				}%
			};%
			\node[yshift=-0.31725\paperheight, xshift=-0.45\paperwidth] at (current page.center){%
				\includegraphics[width=0.075\paperheight, keepaspectratio]{%
					\PATH templates/template_book/images/titlepage/icons/Dragon-D.png%
				}%
			};%
			
			\node[yshift=-0.405\paperheight, xshift=0.39\paperwidth] at (current page.center){%
				\includegraphics[width=0.2\paperwidth, keepaspectratio]{%
					\PATH templates/template_book/images/titlepage/icons/M4RZ-Crafting_icon.png%
				}%
			};%
			
			\def\stackgap{0.01pt}
			\node[yshift=-0.415\paperheight, xshift=-0.075\paperwidth, text width=16cm] at (current page.center) {\titlefont{ \shadowfy{#9}}};
		\end{tikzpicture}
	\end{titlepage}
}%
% ------------------------------------------------------------------------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# Dungeon Last Page #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
\newcommand{\bookLastPage}[8]{%
	\clearpage%
	\thispagestyle{empty}%
	\begin{tikzpicture}[remember picture,overlay]%
		\node[opacity=1,inner sep=0pt,yshift=#2, xshift=#3] at (current page.center){\includegraphics[#4,  keepaspectratio]{#1}};%
		\addImageDBEntry{BackCover}{Back Cover}{Art}{#5}{#6}{#7}%
		\node[opacity=1,inner sep=0pt] at (current page.center){%
			\includegraphics[min width=\paperwidth, height=\paperheight, keepaspectratio]{%
				\PATH  templates/template_book/images/titlepage/backcover-black-part.png%
			}%
		};%
		
		\def\primarycolor{MarzRed}%
		\def\secondarycolor{black!80}%
		%\def\secondarycolor{MarzDarkRed}%
		\def\stackgap{0.1pt}
		\node[yshift=0.1\paperheight, xshift=-0.25\paperwidth] at (current page.center) {%
			\adjustbox{valign=c}{%
				\parbox{0.5\textwidth}{\centering{
					\parbox{0.4\textwidth}{%
						\centering\shadowfiedSCTitle{Big} ~ \shadowfiedSCTitle{Thanks} ~ \shadowfiedSCTitle{To} ~ \shadowfiedSCTitle{These} ~ \shadowfiedSCTitle{Artists}%
					}%
					\par\vspace*{\ThanksSpacing}%
					\parbox{0.45\textwidth}{%
						\large{\begin{itemize}[label=\textcolor{white}{\textbullet}]%
							\DTLforeach*{imageDB}{\thisPage=Page, \thisAdditionalInformation=AdditionalInformation, \thisURL=URL, \thisArtName=ArtName, \thisArtist=Artist}{%
								\item \textcolor{white}{\thisPage ~\thisAdditionalInformation :} \textcolor{orange}{\href{\thisURL}{\thisArtName ~by \thisArtist}}%
							}%
						\end{itemize}}%
					}%
				}}%
			}%
		};
		
		\def\stackgap{0.01pt}
		\ifthenelse{\equal{#8}{}}{}{%
			\node[yshift=-0.275\paperheight, xshift=-0.25\paperwidth] at (current page.center) {%
				\parbox{0.4\textwidth}{%
					\centering\titlefont{\large\shadowfy{#8}}%
				}
			};%
		}%
		
		\node[yshift=-0.4\paperheight, xshift=-0.25\paperwidth] at (current page.center) {%
			\includegraphics[width=0.25\paperwidth, keepaspectratio]{%
				%\PATH  templates/template_book/images/titlepage/DnD_Ampersand.png%
				\PATH  templates/template_book/images/titlepage/icons/5eMC.png%
			}%
		};%
	\end{tikzpicture}%
}%
% ------------------------------------------------------------------------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# Dungeon Titlepage #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
\newcommand{\dungeonTitlePage}[8]{%
	\thispagestyle{empty}
	\begin{tikzpicture}[remember picture,overlay]
		\expandafter\def\expandafter\temp\expandafter{#1}%
		\edef\temp{#1}
		\expandafter\splitShadowfyColors\temp\relax%
		
		\node[opacity=1,inner sep=0pt,xshift=#2,yshift=#3] at (current page.center){\includegraphics[#4, keepaspectratio]{#5}};
		\addImageDBEntry#6
		\node[yshift=0.405\paperheight] at (current page.center) {\shadowfyBookTitleName{#7}};
				
		\coordinate (redline_left) at ($(current page.center) + (-0.3\paperwidth, 0.375\paperheight)$);
		\draw [rulered, fill = red] (redline_left) -- ++( 0.3\paperwidth, 0.075 ) -- ++( 0.3\paperwidth, -0.075 ) -- ++( -0.3\paperwidth, -0.075 );
		
		\expandafter\def\expandafter\temp\expandafter{#8}%
		\edef\temp{#8}
		\expandafter\splitShadowfyColors\temp\relax%
		\def\stackgap{0.01pt}
		\node[yshift=-0.4\paperheight] at (current page.center) {\titlefont{ \shadowfy{The homebrew Dungeon "#7"}}};
	\end{tikzpicture}
}%
% ------------------------------------------------------------------------------------------------- %
% ################################################################################################# %
% ---------------------------------- Letter, Notes  and Messages ---------------------------------- %
% +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# Handwritten Notes #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
% Weathered Note Background
\newtcolorbox{weatheredNote}[4][]{
	enhanced,
	boxrule=0pt,
	arc=0pt,
	outer arc=0pt,
	frame hidden,
	opacityback=0,
	width=#2,
	valign=center,
	left=20pt, % Set left padding to zero
	right=20pt, % Set right padding to zero
	top=20pt, % Set top padding to zero
	bottom=20pt, % Set bottom padding to zero
	overlay={
		\node[opacity=1, anchor=north west, inner sep=0pt, outer sep=0pt] at (frame.north west) {%
			\includegraphics[width=#2, height=#3]{\PATH templates/template_book/images/letters-and-notes/#4}%
		};%
	},%
	#1
}
\newcommand{\handwrittenNote}[4]{
	\node[inner sep=0pt, outer sep=0pt] {%
		\begin{tikzpicture}%
			\node [inner sep=0pt] {%
				\begin{weatheredNote}{#1}{\dimexpr 1.5\fontdimen6\font * (#2) + 40pt\relax}{#3}%
					{\fontsize{20}{7}{\notefont #4}}%
				\end{weatheredNote}
			};%
		\end{tikzpicture}%
	};%
}