\usepackage{fontspec}

\usepackage[singlelinecheck=false]{caption}
\usepackage{lipsum}
\usepackage{listings}
\usepackage{shortvrb}
\usepackage{stfloats}

\usepackage{pstricks}
\usepackage[pscoord]{eso-pic}% The zero point of the coordinate system is the lower left corner of the page (the default).
\usepackage{calc}
\usepackage[absolute]{textpos}
\usepackage{graphbox}

\usepackage{tikzpagenodes}
\usetikzlibrary{positioning}
\usetikzlibrary{fadings} 
\usepackage{varwidth}

\captionsetup[table]{labelformat=empty,font={sf,sc,bf,},skip=0pt}

\MakeShortVerb{|}

\lstset{%
  basicstyle=\ttfamily,
  language=[LaTeX]{TeX},
  breaklines=true,
}

% --------------------------------------------------------------------------------------------------- %
% ################################################################################################### %
% #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# New  Commands #-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-# %
% ################################################################################################### %
% --------------------------------------------------------------------------------------------------- %

\newcommand{\MonsterSheetGeometry}{%
	\newgeometry{%
		hmargin 	= .5in, % Left and right margins
		top 		= .46in, % Top of text area to top of page
		bottom		= .4in, % Bottom of text area to bottom of page
		footskip  = .32in, % Bottom of text area to bottom of footer text
		columnsep = .33in, % Space between columns
	}%
}%

\newcommand{\nopagebreakchapter}[1]{%
	{\let\clearpage\relax \chapter*{#1}}%
}%

\newcommand{\nopagebreaksection}[1]{%
	{\let\clearpage\relax \section*{#1}}%
}%

\tikzfading[name=fade down,
top color=transparent!60,
bottom color=transparent!100]

\newcommand{\MonsterBannerGraphic}[5]{
	\newpage
	\newgeometry{
		hmargin   = .5in,
		top       = #2, % Top of text area to top of page
		bottom    = .5in,
		footskip  = .32in, % Bottom of text area to bottom of footer text
		columnsep = .33in, % Space between columns
	}
	
	\begin{tikzpicture}[overlay, remember picture, inner sep=0pt, outer sep=0pt, path fading=fade down]%
		\node (posSW) at (current page text area.north west) {};%
		\node[above left=#2 and 1.25cm of posSW, anchor=north west] (cornerSW) {%
			\begin{minipage}{\paperwidth}%%
	        	\centering\includegraphics[width=\paperwidth, height=#3#5]{#4}%
	      	\end{minipage}%
		};%
	\end{tikzpicture}%
	%{\let\clearpage\relax \section*{\entryfont #1}}
	\nopagebreaksection{#1}
}

\newcommand{\MonsterFooterGraphic}[4]{
	\newpage
	\newgeometry{
		hmargin   = .5in,
		top       = .46in, % Top of text area to top of page
		bottom    = #1,
		footskip  = .32in, % Bottom of text area to bottom of footer text
		columnsep = .33in, % Space between columns
	}
	\begin{tikzpicture}[overlay, remember picture, inner sep=0pt, outer sep=0pt, path fading=fade down]%
		\node (posSW) at (current page text area.south west) {};%
		\node[below left=#1 and 1.25cm of posSW, anchor=south west] (cornerSW) {%
			\begin{minipage}{\paperwidth}%%
	        	\centering\includegraphics[width=\paperwidth, height=#2#4]{#3}%
	      	\end{minipage}%
		};%
	\end{tikzpicture}%
}

\newcommand{\MonsterShortInfoBox}[5]{
	\node[above right=#1 and #2 of posSW, anchor=south west] (infotext) {%
		\begin{tikzpicture}%
			\node [rotate=#3, inner sep=5pt, fill=PhbTan!20, path fading] {%
				\begin{varwidth}{#4}%
					\scriptsize{#5}%
				\end{varwidth}%
			};%
		\end{tikzpicture}%
	};%
}

\def\PictureOverlay{pictureoverlay}
\def\InfoBoxOverlay{infoboxoverlay}

\newcommand{\MonsterGraphicAndShortInfo}[9]{%
	\begin{tikzpicture}[overlay, remember picture, inner sep=0pt, outer sep=0pt, path fading=fade down]%
		\node (posSW) at (current page text area.south west) {};%
		\ifthenelse{\equal{#5}{\PictureOverlay}}{\MonsterShortInfoBox{#1}{#2}{#3}{#4}{#6}}{}%
		\node[below left=#7 and 1cm of posSW, anchor=south west] (cornerSW) {%
			\begin{minipage}{1.15\columnwidth}%%
	        	\centering\includegraphics[width=1.025\columnwidth, height=#8, keepaspectratio]{#9}%
	      	\end{minipage}%
		};%
		\ifthenelse{\equal{#5}{\InfoBoxOverlay}}{\MonsterShortInfoBox{#1}{#2}{#3}{#4}{#6}}{}%
	\end{tikzpicture}%
}%

\newcommand{\MonsterVariantInfoBox}[2]{
	\begingroup%
	\DndSetThemeColor[PhbLightCyan]%
	\begin{DndSidebar}{\large \entryfont Variant: #1}%
		\noindent\small\entryfont #2%
	\end{DndSidebar}%
	\endgroup%
}

\newcommand{\MonsterVariant}[5]{%
	\vspace*{-2.75cm + #1}\begin{center}\begin{tikzpicture}%
		\node (picture) at (0,0) {\includegraphics[width=\columnwidth -2em, height=190pt, keepaspectratio]{#2}};%
	\end{tikzpicture}\end{center}\vspace*{#3}%
	\MonsterVariantInfoBox{#4}{#5}
}%

\newcommand{\blocktextlinebreak}{~~~~~~~~~~~~~~~~~~~\vspace*{-1.2\fontdimen6\font}\\}
